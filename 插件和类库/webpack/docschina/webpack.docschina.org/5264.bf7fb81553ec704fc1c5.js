(self.webpackChunk=self.webpackChunk||[]).push([[5264],{5264:function(n){n.exports='<p>资源模块(asset module)是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外 loader。</p> <p>在 webpack 5 之前，通常使用：</p> <ul> <li><a href="loaders/raw-loader/index.htm"/*tpa=https://webpack.docschina.org/loaders/raw-loader/*/><code>raw-loader</code></a> 将文件导入为字符串</li> <li><a href="loaders/url-loader/index.htm"/*tpa=https://webpack.docschina.org/loaders/url-loader/*/><code>url-loader</code></a> 将文件作为 data URI 内联到 bundle 中</li> <li><a href="loaders/file-loader/index.htm"/*tpa=https://webpack.docschina.org/loaders/file-loader/*/><code>file-loader</code></a> 将文件发送到输出目录</li> </ul> <p>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</p> <ul> <li><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现。</li> <li><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现。</li> <li><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现。</li> <li><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 <code>url-loader</code>，并且配置资源体积限制实现。</li> </ul> <p>当在 webpack 5 中使用旧的 assets loader（如 <code>file-loader</code>/<code>url-loader</code>/<code>raw-loader</code> 等）和 asset 模块时，你可能想停止当前 asset 模块的处理，并再次启动处理，这可能会导致 asset 重复，你可以通过将 asset 模块的类型设置为 <code>\'javascript/auto\'</code> 来解决。</p> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">module.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">  rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\\.(png|jpg|gif)$/i,\n</span><span class="token prefix unchanged"> </span><span class="token line">       use: [\n</span><span class="token prefix unchanged"> </span><span class="token line">         {\n</span><span class="token prefix unchanged"> </span><span class="token line">           loader: \'url-loader\',\n</span><span class="token prefix unchanged"> </span><span class="token line">           options: {\n</span><span class="token prefix unchanged"> </span><span class="token line">             limit: 8192,\n</span><span class="token prefix unchanged"> </span><span class="token line">           }\n</span><span class="token prefix unchanged"> </span><span class="token line">         },\n</span><span class="token prefix unchanged"> </span><span class="token line">       ],\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       type: \'javascript/auto\'\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     },\n</span><span class="token prefix unchanged"> </span><span class="token line">  ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span>}</code></pre> <p>如需从 asset loader 中排除来自新 URL 处理的 asset，请添加 <code>dependency: { not: [\'url\'] }</code> 到 loader 配置中。</p> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">module.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\\.(png|jpg|gif)$/i,\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       dependency: { not: [\'url\'] }, \n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       use: [\n</span><span class="token prefix unchanged"> </span><span class="token line">         {\n</span><span class="token prefix unchanged"> </span><span class="token line">           loader: \'url-loader\',\n</span><span class="token prefix unchanged"> </span><span class="token line">           options: {\n</span><span class="token prefix unchanged"> </span><span class="token line">             limit: 8192,\n</span><span class="token prefix unchanged"> </span><span class="token line">           },\n</span><span class="token prefix unchanged"> </span><span class="token line">         },\n</span><span class="token prefix unchanged"> </span><span class="token line">       ],\n</span><span class="token prefix unchanged"> </span><span class="token line">     },\n</span><span class="token prefix unchanged"> </span><span class="token line">   ],\n</span><span class="token prefix unchanged"> </span><span class="token line"> }\n</span></span>}</code></pre> <h2 id="resource-assets">Resource 资源 <a href="#resource-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\')\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> module: {\n</span><span class="token prefix inserted">+</span><span class="token line">   rules: [\n</span><span class="token prefix inserted">+</span><span class="token line">     {\n</span><span class="token prefix inserted">+</span><span class="token line">       test: /\\.png/,\n</span><span class="token prefix inserted">+</span><span class="token line">       type: \'asset/resource\'\n</span><span class="token prefix inserted">+</span><span class="token line">     }\n</span><span class="token prefix inserted">+</span><span class="token line">   ]\n</span><span class="token prefix inserted">+</span><span class="token line"> },\n</span></span>};</code></pre> <p><strong>src/index.js</strong></p> <pre><code class="hljs language-js"><span class="token keyword">import</span> mainImage <span class="token keyword">from</span> <span class="token string">\'images/main.png\'/*tpa=https://webpack.docschina.org/images/main.png*/</span><span class="token punctuation">;</span>\n\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> mainImage<span class="token punctuation">;</span> <span class="token comment">// \'dist/151cfcfa1bd74779aadb.png\'/*tpa=https://webpack.docschina.org/dist/151cfcfa1bd74779aadb.png*/</span></code></pre> <p>所有 <code>.png</code> 文件都将被发送到输出目录，并且其路径将被注入到 bundle 中。</p> <h3 id="custom-output-filename">自定义输出文件名 <a href="#custom-output-filename" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3> <p>默认情况下，<code>asset/resource</code> 模块以 <code>[hash][ext][query]</code> 文件名发送到输出目录。</p> <p>可以通过在 webpack 配置中设置 <a href="configuration/output/index.htm#outputassetmodulefilename"/*tpa=https://webpack.docschina.org/configuration/output/#outputassetmodulefilename*/><code>output.assetModuleFilename</code></a> 来修改此模板字符串：</p> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\'),\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   assetModuleFilename: \'images/[hash][ext][query]\'\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },\n</span><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\\.png/,\n</span><span class="token prefix unchanged"> </span><span class="token line">       type: \'asset/resource\'\n</span><span class="token prefix unchanged"> </span><span class="token line">     }\n</span><span class="token prefix unchanged"> </span><span class="token line">   ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span>};</code></pre> <p>另一种自定义输出文件名的方式是，将某些资源发送到指定目录：</p> <pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\'),\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   assetModuleFilename: \'images/[hash][ext][query]\'\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },\n</span><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\\.png/,\n</span><span class="token prefix unchanged"> </span><span class="token line">       type: \'asset/resource\'\n</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     }\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     },\n</span><span class="token prefix inserted">+</span><span class="token line">     {\n</span><span class="token prefix inserted">+</span><span class="token line">       test: /\\.html/,\n</span><span class="token prefix inserted">+</span><span class="token line">       type: \'asset/resource\',\n</span><span class="token prefix inserted">+</span><span class="token line">       generator: {\n</span><span class="token prefix inserted">+</span><span class="token line">         filename: \'static/[hash][ext][query]\'\n</span><span class="token prefix inserted">+</span><span class="token line">       }\n</span><span class="token prefix inserted">+</span><span class="token line">     }\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span>};</code></pre> <p>使用此配置，所有 <code>html</code> 文件都将被发送到输出目录中的 <code>static</code> 目录中。</p> <p><code>Rule.generator.filename</code> 与 <a href="configuration/output/index.htm#outputassetmodulefilename"/*tpa=https://webpack.docschina.org/configuration/output/#outputassetmodulefilename*/><code>output.assetModuleFilename</code></a> 相同，并且仅适用于 <code>asset</code> 和 <code>asset/resource</code> 模块类型。</p> <h2 id="inlining-assets">inline 资源(inlining asset) <a href="#inlining-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\'),\n</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   assetModuleFilename: \'images/[hash][ext][query]\'\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },\n</span><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       test: /\\.png/,\n</span><span class="token prefix deleted">-</span><span class="token line">       type: \'asset/resource\'\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\\.svg/,\n</span><span class="token prefix inserted">+</span><span class="token line">       type: \'asset/inline\'\n</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     },\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     }\n</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     {\n</span><span class="token prefix deleted">-</span><span class="token line">       test: /\\.html/,\n</span><span class="token prefix deleted">-</span><span class="token line">       type: \'asset/resource\',\n</span><span class="token prefix deleted">-</span><span class="token line">       generator: {\n</span><span class="token prefix deleted">-</span><span class="token line">         filename: \'static/[hash][ext][query]\'\n</span><span class="token prefix deleted">-</span><span class="token line">       }\n</span><span class="token prefix deleted">-</span><span class="token line">     }\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> }\n</span></span>};</code></pre> <p><strong>src/index.js</strong></p> <pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import mainImage from \'images/main.png\'/*tpa=https://webpack.docschina.org/images/main.png*/;\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import metroMap from \'https://webpack.docschina.org/images/metro.svg\';\n</span></span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> img.src = mainImage; // \'dist/151cfcfa1bd74779aadb.png\'/*tpa=https://webpack.docschina.org/dist/151cfcfa1bd74779aadb.png*/\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> block.style.background = `url(${metroMap})`; // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)</span></span></code></pre> <p>所有 <code>.svg</code> 文件都将作为 data URI 注入到 bundle 中。</p> <h3 id="custom-data-uri-generator">自定义 data URI 生成器 <a href="#custom-data-uri-generator" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3> <p>webpack 输出的 data URI，默认是呈现为使用 Base64 算法编码的文件内容。</p> <p>如果要使用自定义编码算法，则可以指定一个自定义函数来编码文件内容：</p> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">const path = require(\'path\');\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const svgToMiniDataURI = require(\'mini-svg-data-uri\');\n</span></span>\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\')\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\\.svg/,\n</span><span class="token prefix unchanged"> </span><span class="token line">       type: \'asset/inline\',\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       generator: {\n</span><span class="token prefix inserted">+</span><span class="token line">         dataUrl: content => {\n</span><span class="token prefix inserted">+</span><span class="token line">           content = content.toString();\n</span><span class="token prefix inserted">+</span><span class="token line">           return svgToMiniDataURI(content);\n</span><span class="token prefix inserted">+</span><span class="token line">         }\n</span><span class="token prefix inserted">+</span><span class="token line">       }\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }\n</span><span class="token prefix unchanged"> </span><span class="token line">   ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span>};</code></pre> <p>现在，所有 <code>.svg</code> 文件都将通过 <code>mini-svg-data-uri</code> 包进行编码。</p> <h2 id="source-assets">source 资源(source asset) <a href="#source-assets" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">const path = require(\'path\');\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const svgToMiniDataURI = require(\'mini-svg-data-uri\');\n</span></span>\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\')\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       test: /\\.svg/,\n</span><span class="token prefix deleted">-</span><span class="token line">       type: \'asset/inline\',\n</span><span class="token prefix deleted">-</span><span class="token line">       generator: {\n</span><span class="token prefix deleted">-</span><span class="token line">         dataUrl: content => {\n</span><span class="token prefix deleted">-</span><span class="token line">           content = content.toString();\n</span><span class="token prefix deleted">-</span><span class="token line">           return svgToMiniDataURI(content);\n</span><span class="token prefix deleted">-</span><span class="token line">         }\n</span><span class="token prefix deleted">-</span><span class="token line">       }\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\\.txt/,\n</span><span class="token prefix inserted">+</span><span class="token line">       type: \'asset/source\',\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }\n</span><span class="token prefix unchanged"> </span><span class="token line">   ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span>};</code></pre> <p><strong>src/example.txt</strong></p> <pre><code class="hljs language-text">Hello world\n</code></pre> <p><strong>src/index.js</strong></p> <pre><code class="hljs language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import metroMap from \'https://webpack.docschina.org/images/metro.svg\';\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import exampleText from \'https://webpack.docschina.org/example.txt\';\n</span></span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> block.style.background = `url(${metroMap}); // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> block.textContent = exampleText; // \'Hello world\'</span></span></code></pre> <p>所有 <code>.txt</code> 文件将原样注入到 bundle 中。</p> <h2 id="URL-资源">URL 资源<a href="#URL-%E8%B5%84%E6%BA%90" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2> <p>当使用 <code>new URL(\'./path/to/asset\', import.meta.url)</code>，webpack 也会创建资源模块。</p> <p><strong>src/index.js</strong></p> <pre><code class="hljs language-js"><span class="token keyword">const</span> logo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">\'https://webpack.docschina.org/logo.svg\'</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> <p>根据你配置中 <a href="configuration/target/index.htm"/*tpa=https://webpack.docschina.org/configuration/target/*/><code>target</code></a> 的不同，webpack 会将上述代码编译成不同结果：</p> <pre><code class="hljs language-js"><span class="token comment">// target: web</span>\n<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>__webpack_public_path__ <span class="token operator">+</span> <span class="token string">\'https://webpack.docschina.org/logo.svg\'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>baseURI <span class="token operator">||</span> self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// target: webworker</span>\n<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>__webpack_public_path__ <span class="token operator">+</span> <span class="token string">\'https://webpack.docschina.org/logo.svg\'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// target: node, node-webkit, nwjs, electron-main, electron-renderer, electron-preload, async-node</span>\n<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>__webpack_public_path__ <span class="token operator">+</span> <span class="token string">\'https://webpack.docschina.org/logo.svg\'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'url\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pathToFileUrl</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> <h2 id="general-asset-type">通用资源类型 <a href="#general-asset-type" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\')\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\\.txt/,\n</span><span class="token prefix inserted">+</span><span class="token line">       type: \'asset\',\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }\n</span><span class="token prefix unchanged"> </span><span class="token line">   ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span>};</code></pre> <p>现在，webpack 将按照默认条件，自动地在 <code>resource</code> 和 <code>inline</code> 之间进行选择：小于 8kb 的文件，将会视为 <code>inline</code> 模块类型，否则会被视为 <code>resource</code> 模块类型。</p> <p>可以通过在 webpack 配置的 module rule 层级中，设置 <a href="configuration/module/index.htm#ruleparserdataurlcondition"/*tpa=https://webpack.docschina.org/configuration/module/#ruleparserdataurlcondition*/><code>Rule.parser.dataUrlCondition.maxSize</code></a> 选项来修改此条件：</p> <p><strong>webpack.config.js</strong></p> <pre><code class="hljs language-diff">const path = require(\'path\');\n\nmodule.exports = {\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: \'src/index.js\'/*tpa=https://webpack.docschina.org/src/index.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line"> output: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   filename: \'main.js\'/*tpa=https://webpack.docschina.org/main.js*/,\n</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, \'dist\')\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span><span class="token prefix unchanged"> </span><span class="token line"> module: {\n</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [\n</span><span class="token prefix unchanged"> </span><span class="token line">     {\n</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\\.txt/,\n</span><span class="token prefix unchanged"> </span><span class="token line">       type: \'asset\',\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       parser: {\n</span><span class="token prefix inserted">+</span><span class="token line">         dataUrlCondition: {\n</span><span class="token prefix inserted">+</span><span class="token line">           maxSize: 4 * 1024 // 4kb\n</span><span class="token prefix inserted">+</span><span class="token line">         }\n</span><span class="token prefix inserted">+</span><span class="token line">       }\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }\n</span><span class="token prefix unchanged"> </span><span class="token line">   ]\n</span><span class="token prefix unchanged"> </span><span class="token line"> },\n</span></span>};</code></pre> <p>还可以 <a href="configuration/module/index.htm#ruleparserdataurlcondition"/*tpa=https://webpack.docschina.org/configuration/module/#ruleparserdataurlcondition*/>指定一个函数</a> 来决定是否 inline 模块。</p> '}}]);